<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.4.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="stylesheet" href="/css/mine.css">
    <title>mine</title>
</head>

<body>


    <div class="container">

        <%- include ('partials/sidebar') %>


            <!-- Main content -->
            <main class="main-content">

                <div class="mine-container">

                    <!-- Profile Header -->
                    <div class="mine-header">
                        <div class="icons">
                            <div class="icon" id="open-settings"><i class="ri-settings-4-line"></i></div>

                            <!-- Slide-out settings panel -->
                            <div class="settings-panel" id="settingsPanel">
                                <div class="settings-content">
                                    <span class="close-settings" id="close-settings"><i
                                            class="ri-close-fill"></i></span>

                                    <!-- Your settings HTML here -->
                                    <div class="settings-header">Settings</div>

                                    <div class="setting-item1">
                                        <span class="setting-label">Alert</span>
                                        <label class="switch">
                                            <input type="checkbox" checked>
                                            <span class="slider"></span>
                                        </label>
                                    </div>

                                    <div class="setting-item1">
                                        <span class="setting-label">Posh Notification</span>
                                        <label class="switch">
                                            <input type="checkbox">
                                            <span class="slider"></span>
                                        </label>
                                    </div>

                                    <div class="setting-item1">
                                        <span class="setting-label">Withdrawal currency</span>
                                        <select class="currency-select">
                                            <option value="USD" selected>USD</option>
                                            <option value="EUR">EUR</option>
                                            <option value="GBP">GBP</option>
                                            <option value="KES">KES</option>
                                            <option value="CAD">CAD</option>
                                            <option value="NGN">NGN</option>
                                            <option value="AUD">AUD</option>
                                            <option value="GHS">GHS</option>
                                            <option value="ZAR">ZAR</option>
                                            <option value="INR">INR</option>
                                            <option value="JPY">JPY</option>
                                            <option value="CNY">CNY</option>
                                            <option value="MXN">MXN</option>
                                            <option value="SGD">SGD</option>
                                            <option value="BRL">BRL</option>
                                            <option value="RUB">RUB</option>
                                            <option value="SAR">SAR</option>
                                            <option value="AED">AED</option>
                                            <option value="THB">THB</option>
                                            <option value="TRY">TRY</option>
                                            <option value="SEK">SEK</option>
                                            <option value="NOK">NOK</option>
                                            <option value="PLN">PLN</option>
                                            <option value="DKK">DKK</option>
                                        </select>
                                    </div>


                                    <!-- CHANING OF EMAILS, USERNAME AND PHONE NUM  -->
                                    <span class="setting-label">Edit Your Profile Details</span>
                                    <form id="profileForm">
                                        <label>Name:</label>
                                        <input type="text" name="name" placeholder="Enter new name" required />

                                        <label>Email:</label>
                                        <input type="email" name="email" placeholder="Enter new email" required />

                                        <label>New Password (optional):</label>
                                        <!-- <input type="password" name="newPassword"placeholder="Enter new password (if changing)" /> -->
                                        <div class="input-container">
                                            <input type="password" id="password" name="newPassword" required
                                                placeholder="Enter new password (if changing)">
                                            <i class="ri-eye-off-line toggle-password"
                                                onclick="togglePassword('password', this)"></i>
                                        </div>


                                        <button type="submit">Save Changes</button>
                                    </form>


                                    <div class="setting-item1">
                                        <span class="setting-label">About Us</span>
                                        <span class="about-value">1.10.21(205)</span>
                                    </div>

                                    <div class="delete-account">Delete Account</div>
                                    <button class="logout-btn" onclick="window.location.href='/'">Logout</button>
                                </div>
                            </div>
                        </div>




                        <!-- ALL ABOUT PROFILE  -->
                        <div class="profile-summary">
                            <div class="profile-img-wrapper">
                                <div class="profile-initials">
                                    <% const nameParts=user.name.trim().split(' ');
                                       let initials = '';
                                       if (nameParts.length === 1) {
                                       initials = nameParts[0].substring(0, 2);
                                       } else {
                                       initials = nameParts[0][0] + nameParts[1][0]; }%>
                                     <%= initials.toUpperCase() %>
                                </div>
                            </div>
                            
                        <div>
                            <h2 class="name">
                                <%= user.name %>
                            </h2>
                            <p class="email">
                                <%= user.email %>
                            </p>
                        </div>
                    </div>
                </div>



                    <!-- ALL ABOUT STATS-->
                    <div class="stats">
                        <div class="stat">
                            <p class="number">$<%= (user.balance_usd || 0).toFixed(2) %></p>
                            <p class="label">Total Balance</p>
                        </div>
                        <div class="stat">
                            <p class="number">$<%= totalSpent.toFixed(2) %></p>
                            <p class="label">Total Spendings</p>
                        </div>
                        <div class="stat">
                            <p class="number"><%= totalOrders %></p>
                            <p class="label">Total Orders</p>
                        </div>
                    </div>



                    <!-- Menu LINKS-->
                    <div class="mine-menu">

                        <a href="/account">
                            <div class="menu-item">
                                <div class="left">
                                    <img src="/images/offer1.jpeg" alt="Account" class="icon-img" />
                                    <span>Account</span>
                                </div>
                                <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                            </div>
                        </a>
                      
                        <a href="#">
                            <div class="menu-item">
                                <div class="left">
                                    <img src="/images/offer7.jpeg" alt="Affiliates" class="icon-img" />
                                    <span>Affiliates</span>
                                </div>
                                <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                            </div>
                        </a>
                        
                        <a href="/support">
                            <div class="menu-item">
                                <div class="left">
                                    <img src="images/offer6.jpeg" alt="Support" class="icon-img" />
                                    <span>Support</span>
                                </div>
                                <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                            </div>
                        </a>

                        <a href="/engagement">
                            <div class="menu-item">
                                <div class="left">
                                    <img src="images/offer3.jpeg" alt="Services" class="icon-img" />
                                    <span>Services</span>
                                </div>
                                <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                            </div>
                        </a>
                        
                        <a href="#">
                            <div class="menu-item">
                                <div class="left">
                                    <img src="images/offer5.jpeg" alt="Childs Panel" class="icon-img" />
                                    <span>Childs Panel</span>
                                </div>
                                <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                            </div>
                        </a>
                        
                        <a href="#">
                        <div class="menu-item">
                            <div class="left">
                                <img src="/images/offer12.jpg" alt="Refer & Earn" class="icon-img" />
                                <span>Refer & Earn</span>
                            </div>
                            <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                        </div>
                       </a>
                        
                        <a href="/api-init">
                        <div class="menu-item">
                            <div class="left">
                                <img src="/images/offer4.jpeg" alt="API Integration" class="icon-img" />
                                <span>API Integration</span>
                            </div>
                            <span class="arrow"><i class="ri-arrow-right-s-line"></i></span>
                        </div>
                       </a>
                        
                </div>
                </div>
            </div>



<!-- /* ALL ABOUT REVIEWS  */ -->
  <div class="review-container">
    <h3>Leave a Review</h3>
    <p class="notice">
 We’d love to hear from you! Share your experience using Poplox — your feedback helps us grow and serve you better.
    </p>

    <form id="reviewForm">
  <label for="country">Name</label>
  <input type="text" name="name" placeholder="Your Name" required />

  <label for="currency">Email</label>
  <input type="email" name="email" placeholder="Your Email (optional)" />

  <label for="bank">Rating (1–5 Stars)</label>
<label>
    <select name="rating">
      <option value="5">★★★★★</option>
      <option value="4">★★★★☆</option>
      <option value="3">★★★☆☆</option>
      <option value="2">★★☆☆☆</option>
      <option value="1">★☆☆☆☆</option>
    </select>
  </label>

  <label for="accountNumber">Title</label>
  <input type="text" id="accountNumber" name="title" required placeholder="Best SMM Panel I’ve used!" />

  <label for="accountName">Full Review</label>
  <textarea id="message" name="review" required placeholder="Textarea for detailed experience."></textarea>

  <button type="submit">Submit Review</button>
</form>

</div>


</main>
</div>

        <span class="footer__blur"></span>





 <!-- Password toggle -->
    <script>
        function togglePassword(fieldId, icon) {
            let input = document.getElementById(fieldId);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace("ri-eye-off-line", "ri-eye-line");
            } else {
                input.type = "password";
                icon.classList.replace("ri-eye-line", "ri-eye-off-line");
            }
        }
    </script>





<!-- FUNTION TO ReVIEWS  -->
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>
  document.getElementById("reviewForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const formData = new FormData(this);
    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      title: formData.get("title"),
      review: formData.get("review"),
      rating: formData.get("rating")
    };

    try {
      const response = await fetch("/submit-review", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      Toastify({
        text: result.message,
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: response.ok ? "#28a745" : "#dc3545"
      }).showToast();

      if (response.ok) this.reset();
    } catch (err) {
      Toastify({
        text: "Submission failed.",
        duration: 5000,
        gravity: "top",
        position: "center",
        backgroundColor: "#dc3545"
      }).showToast();
    }
  });
</script>




    <!-- FUNCTION TO OPEN SETTING AND CLOSE SETTING  -->
<script>
    const openSettings = document.getElementById("open-settings");
    const closeSettings = document.getElementById("close-settings");
    const settingsPanel = document.getElementById("settingsPanel")
    openSettings.addEventListener("click", () => {
        settingsPanel.classList.add("open");
    })
    closeSettings.addEventListener("click", () => {
        settingsPanel.classList.remove("open");
    })
    // Optional: click outside to close
    document.addEventListener("click", (e) => {
        if (!settingsPanel.contains(e.target) && !openSettings.contains(e.target)) {
            settingsPanel.classList.remove("open");
        }
    });
</script>



<!-- FUNCTION TO CHANGE USERNAME, EMAILS AND NUMBER  -->
<script>
    document.getElementById("profileForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {
            name: formData.get("name"),
            email: formData.get("email"),
            newPassword: formData.get("newPassword") // optional
        };

        try {
            const response = await fetch("/auth/update-profile", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            Toastify({
                text: result.message || "Profile updated successfully",
                duration: 4000,
                gravity: "top",
                position: "center",
                backgroundColor: response.ok ? "#28a745" : "#dc3545"
            }).showToast();

            // ✅ Update form fields safely
            const nameInput = document.querySelector("input[name=' name']"); const
                emailInput = document.querySelector("input[name='email' ]"); if (nameInput)
                nameInput.value = result.user.name; if (emailInput)
                emailInput.value = result.user.email;
        } catch (error) {
            Toastify({
                text: "Something went wrong!", duration: 4000, gravity: "top",
                position: "center", backgroundColor: "#dc3545"
            }).showToast();
        }
    }); </script>



                                        <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
                                        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                                        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                                        <script src="/js/dashboard.js"></script>
</body>

</html>